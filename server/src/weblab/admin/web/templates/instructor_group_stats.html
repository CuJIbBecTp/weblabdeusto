{% extends 'weblab-master.html' %}
{% block body %}

{% from "_widgets.html" import timeline, timetable, sna %}

<div class="row">
    <div class="span12">
        <a name="top"></a>
        <h1>{{ group.name }}</h1>

        <h3>Table of contents</h3>
        <ul>
            <li><a href="#summary">Summary</a>
            <ul>
                <li><a href="#experiments_available">Experiments available</a></li>
                <li><a href="#uses">Uses</a></li>
            </ul>
            </li>
            {% if results['timeline_values'] %}
            <li><a href="#usage_patterns">Usage patterns</a>
            <ul>
                <li><a href="#uses_per_day">Uses per day</a></li>
                <li><a href="#uses_per_week">Uses per week</a></li>
                <li><a href="#avg_per_day">Average time per day</a></li>
                <li><a href="#session_per_day">Session time frequency</a></li>
                <li><a href="#uses_per_time_of_day">Uses per time of the day</a></li>
            </ul>
            </li>
            <li><a href="#users">Users</a>
            <ul>
                <li><a href="#uses_per_student">Uses per student distribution</a></li>
                <li><a href="#users_summary">Summary</a></li>
                {% if results['links'] %}
                <li><a href="#social_network">Social Network</a></li>
                {% endif %}
            </ul>
            {% endif %}
        </ul>

        <a name="summary"></a>
        <h3>Summary</h3>

        <a name="experiments_available"></a>
        <h4>Experiments available</h4>
        <ul>
            {% for experiment in results['experiments'] %}
                <li>{{ experiment }}</li>
            {% endfor %}
        </ul>
        <a name="uses"></a>
        <h4>Uses</h4>
        <table class="table table-bordered table-hover">
            <thead>
                <tr>
                    <th>Property</th>
                    <th>Value</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Users:</td>
                    <td>{{ statistics['users'] }}</td>
                </tr>
                {% if results['timeline_values'] %}
                <tr>
                    <td>Total uses</td>
                    <td>{{ statistics['uses'] }} uses ({{ '%.2f' % (statistics['uses'] / (statistics['users'] or 1)) }} uses per user)</td>
                </tr>
                <tr>
                    <td>Total time</td>
                    <td>{{ statistics['total_time'] }} seconds ({% if statistics['total_time_human'].days > 1 %}over {{ statistics['total_time_human'].days }} days; {% endif %}{{ '%.2f' % (statistics['total_time'] / (statistics['users'] or 1))}} seconds per user)</td>
                </tr>
                {% endif %}
            </tbody>
        </table>
        {% if results['timeline_values'] %}
        <a name="usage_patterns"></a>
        <h3>Usage patterns</h3>
        <a name="uses_per_day"></a>
        <h4>Uses per day</h4>
        {{ timeline(results['timeline_headers'], results['timeline_values'], "timeline", '%i') }}
        <a name="uses_per_week"></a>
        <h4>Uses per week</h4>
        {{ timeline(results['weekly_timeline_headers'], results['weekly_timeline_values'], "weekly_timeline", '%i') }}
        <a name="avg_per_day"></a>
        <h4>Average time per day</h4>
        {{ timeline(results['time_per_day_headers'], results['time_per_day_values'], "per_day", '%i') }}
        <a name="session_per_day"></a>
        <h4>Session time frequency</h4>
        {{ timeline(results['per_block_headers'], results['per_block_values'], "per_block", '%i') }}
        <a name="uses_per_time_of_day"></a>
        <h4>Uses per time of the day</h4>
        {{ timetable(results['usage_timetable']) }}
        <a name="users"></a>
        <h3>Users</h3>
        <a name="uses_per_student"></a>
        <h4>Uses per student distribution</h4>
        {{ timeline(results['users_timeline_headers'], results['users_timeline_values'], "users_values", '%i') }}
        <a name="users_summary"></a>
        <h4>Summary</h4>
        <table class="table table-bordered table-hover">
            <thead>
                <tr>
                    <th>Student</th>
                    <th>Login</th>
                    <th>Uses</th>
                    <th>Time (seconds)</th>
                    <th>Average time (seconds)</th>
                </tr>
            </thead>
            <tbody>
                {% for (login, full_name), uses in results['users'] %}
                <tr>
                    <td>{{ full_name }}</td>
                    <td>{{ login }}</td>
                    <td>{{ uses }}</td>
                    <td>{{ results['users_time'][login] }}</td>
                    <td>{{ '%.2f' % (results['users_time'][login] / ( uses or 1)) }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% if results['links'] %}
        <a name="social_network"></a>
        <h4>Social Network</h4>
        {{ sna() }}
        {% endif %}
        {% else %}
        <div class="alert alert-error">
            <h3>Sorry, there has been no activity in this group</h3>
        </div>
        {% endif %}
    </div>
</div>

{% endblock %}

{% block tail %}
    {% from "_widgets.html" import timeline_scripts, timeline_load, sna_scripts, sna_load %}
    {{ timeline_scripts() }}
    {{ timeline_load('timeline', 'use') }}
    {{ timeline_load('weekly_timeline', 'use') }}
    {{ timeline_load('per_day', 'second') }}
    {{ timeline_load('users_values', 'use') }}
    {{ timeline_load('per_block', 'use') }}
    {% if results['links'] %}
        {{ sna_scripts() }}
        {{ sna_load(url_for('.gefx', group_id = group.id)) }}
    {% endif %}
{% endblock %}

