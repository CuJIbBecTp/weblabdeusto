{% extends "webclient/_logged_base.html" %}
{% set title="Lab - " + experiment['display_name'] %}

{% import "webclient/_upload.html" as upload %}

{% block styles %}
    {{ super() }}
    {{ upload.styles() }}
{% endblock %}

{% block body %}

    {{ super() }}

    {# Includes the base HTML for the angular App for the laboratory, so that it is (or seems) more modular. #}
    {% include 'webclient/apps/lab/lab.html' %}

{% endblock %}


{% block scripts %}

    {{ super() }}

    {{ upload.scripts() }}

    {{ upload.code(config["UPLOAD_URL"]) }}

    <script type="text/javascript">
        {# Put here all the global variables of those things that will later be accessed by the static JS files #}
        var WL_JSON_URL = "{{ url_for('json.service_url') }}";
        var WL_LAB_URL = "{{ url_for('.static', filename='') }}";
        var WL_LOGIN_URL = "{{ url_for('.login') }}";
        var LOCALES_URL = "{{ url_for('.locales') }}";
        var PREFERRED_LANGUAGE = "{{ get_locale() }}";
        var IFRAME_RESIZER_URL = "{{ url_for('.static', filename='js/iframeResizer.contentWindow.min.js', _external=True, _scheme=request.scheme) }}";
        var EXPERIMENT_DATA = {{ experiment|tojson }};
        var WL_SESSION_ID = "{{ request.cookies.get('weblabsessionid') }}";
        
        {# These ones should be located somewhere else... but just don't know how without using url_for in static files which is what we try to avoid #}
        var RESERVE_STATUS_TEMPLATE_URL = "{{ url_for('.static', filename="webclient/apps/lab/reserve-status/reserve-status.directive.html") }}";

    {# Await for the page #}
    $(document).ready(function () {

        // Bootstrap angular itself.
        angular.bootstrap(document, ['lab']);

    }); //! document.ready

    </script>


    {# TODO: Switch for .min files on release #}
    <script type="text/javascript" src="{{ url_for(".static", filename="bower_components/angular-translate/angular-translate.min.js") }}"></script>
    <script type="text/javascript" src="{{ url_for(".static", filename="bower_components/angular-translate-loader-url/angular-translate-loader-url.min.js") }}"></script>
    <script type="text/javascript" src="{{ url_for(".static", filename="js/iframeResizer.min.js") }}"></script>


    {# Embedded templates #}
    {% include 'webclient/apps/lab/expinfo/expinfo.template.html' %}
    {% include 'webclient/apps/lab/iframe/experiment-iframe.template.html' %}

    <script type="text/javascript" src="{{ url_for(".static", filename="webclient/apps/lab/app.js") }}"></script>
    <script type="text/javascript" src="{{ url_for(".static", filename="webclient/apps/lab/lab.controller.js") }}"></script>
    <script type="text/javascript" src="{{ url_for(".static", filename="webclient/apps/lab/expinfo/expinfo.directive.js") }}"></script>
    <script type="text/javascript" src="{{ url_for(".static", filename="webclient/apps/lab/iframe/resizer.factory.js") }}"></script>
    <script type="text/javascript" src="{{ url_for(".static", filename="webclient/apps/lab/iframe/experiment-iframe.controller.js") }}"></script>
    <script type="text/javascript" src="{{ url_for(".static", filename="webclient/apps/lab/iframe/experiment-iframe.directive.js") }}"></script>
    <script type="text/javascript" src="{{ url_for(".static", filename="webclient/apps/lab/reserve-status/reserve-status.directive.js") }}"></script>

{% endblock %}
