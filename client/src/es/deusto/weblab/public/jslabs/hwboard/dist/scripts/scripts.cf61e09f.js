"use strict";function MainController(a,b,c){function d(b){c.debug("Status update: "+b),b!=a.status&&(a.status=b,a.$apply())}function e(){statusUpdater.start()}function f(){statusUpdater.stop(),a.time=0}function g(b){c.debug("TIME IS: "+b),a.time=b}statusUpdater=b.get("statusUpdater"),statusUpdater.setOnStatusUpdate(d),c.debug("HW board experiment main controller"),Weblab.setOnStartInteractionCallback(e),Weblab.setOnEndCallback(f),Weblab.setOnTimeCallback(g),a.time=0}function WebcamController(a,b){function c(){f(function(){d()},100)}function d(){var b=URI(a.src);b.query({rnd:1e5*Math.random()}),a.src=b.toString()}var e=this,f=b.get("$timeout");e.programRefresh=c}function wlWebcam(){function a(a,b,c,d){function e(){d.programRefresh()}b.find("img").bind("load error",e)}return{restrict:"E",scope:{src:"@src"},templateUrl:"main/webcam/webcam.directive.html",controller:"WebcamController",controllerAs:"webcamController",link:a}}function StatusController(a){function b(){return void 0==a.status?"You need to Reserve the experiment before using it. Please, click on the Reserve button below.":"not_ready"==a.status?"You will probably want to upload your logic file before interacting with the board.":"[STATUS: "+status+"] "+message}a.getDisplay=b}function wlStatus(){function a(){}return{restrict:"E",templateUrl:"main/status/status.directive.html",link:a,controller:"StatusController",controllerAs:"statusController",scope:{status:"=status",message:"=message"}}}function wlButton(){function a(){}return{restrict:"E",templateUrl:"main/button/button.directive.html",link:a,controller:"ButtonController",controllerAs:"buttonController",scope:{ident:"@ident",caption:"@caption",overlay:"@overlay",delay:"=delay"}}}function ButtonController(a,b,c,d){function e(){a.ongoingCommand||(a.ongoingCommand=!0,c.debug("Button "+a.ident+" pressed."),a.isPressed=!0,Weblab.dbgSetOfflineSendCommandResponse("ok"),Weblab.sendCommand("SetPulse on "+a.ident,f,g))}function f(){c.debug("[Button] SetPulse ON"),a.isOn=!0,a.isPressed=!1;var b=a.delay;void 0==b&&(c.error("[BUTTON]: Please define a button delay. Meanwhile setting it to 1000 ms"),b=1e3),d(function(){Weblab.sendCommand("SetPulse off "+a.ident,function(){c.debug("[Button] SetPulse OFF"),a.isOn=!1,a.isPressed=!1,a.ongoingCommand=!1,a.$apply()},function(b){c.error("SetPulse failed (while sending button pulse)"),c.error(b),a.ongoingCommand=!1,a.isPressed=!1,a.$apply()})},b),a.$apply()}function g(){c.error("SetPulse failed"),a.ongoingCommand=!1,a.isPressed=!1,a.$apply()}a.button={},a.isOn=!1,a.isPressed=!1,a.ongoingCommand=!1,a.press=e}function wlSwitch(){function a(){}return{restrict:"E",templateUrl:"main/switch/switch.directive.html",link:a,controller:"SwitchController",controllerAs:"switchController",scope:{ident:"@ident",caption:"@caption",overlay:"@overlay"}}}function SwitchController(a,b,c){function d(){if(!a.ongoingCommand){a.ongoingCommand=!0,c.debug("Switch "+a.ident+" pressed."),a.isPressed=!0,Weblab.dbgSetOfflineSendCommandResponse("ok");var b=a.isOn?"off":"on";Weblab.sendCommand("ChangeSwitch "+b+" "+a.ident,e,f)}}function e(){c.debug("ChangeSwitch succeeded"),a.isOn=!a.isOn,a.isPressed=!1,a.ongoingCommand=!1,a.$apply()}function f(){c.error("SetPulse failed"),a.ongoingCommand=!1,a.isPressed=!1,a.$apply()}a.button={},a.isOn=!1,a.isPressed=!1,a.ongoingCommand=!1,a.press=d}function statusUpdater(a,b,c){function d(a){l=a}function e(){k=c(g,j)}function f(){c.cancel(k)}function g(){Weblab.dbgSetOfflineSendCommandResponse("STATE=programming"),Weblab.sendCommand("STATE",h,i)}function h(a){if(b.debug("SUCCESS: STATUS: "+a),void 0!=l){var d=a.substring(6);l(d)}k=c(g,j)}function i(a){b.error("ERROR: sendCommand (status)"),b.error(a),k=c(g,j)}var j=2e3,k=void 0,l=void 0;return{start:e,stop:f,setOnStatusUpdate:d}}function TimerController(a,b,c){function d(b,c){return 0>b?void(a.time=0):(0==c&&h.startDecreasing(),void(0==b&&h.stopDecreasing()))}function e(){a.time>0&&(a.time-=1)}function f(){c.cancel(h._interval),h._interval=c(e,1e3)}function g(){c.cancel(h._interval)}var h=this;a.$watch("time",d),h.startDecreasing=f,h.stopDecreasing=g}function wlTimer(){return{restrict:"E",templateUrl:"main/timer/timer.directive.html",controller:"TimerController",controllerAs:"timerController",link:wlTimerLink,scope:{time:"=time"}}}function wlTimerLink(){}angular.module("hwboard",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ui.slider"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"main/main.html",controller:"MainController"}).when("/about",{templateUrl:"main/about.html",controller:"AboutController"}).otherwise({redirectTo:"/"})}]),angular.module("hwboard").controller("MainController",MainController),MainController.$inject=["$scope","$injector","$log"],angular.module("hwboard").controller("AboutController",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("hwboard").controller("WebcamController",WebcamController),WebcamController.$inject=["$scope","$injector"],angular.module("hwboard").directive("wlWebcam",wlWebcam),angular.module("hwboard").controller("StatusController",StatusController),StatusController.$inject=["$scope","$injector"],angular.module("hwboard").directive("wlStatus",wlStatus),wlStatus.$inject=["$injector"],angular.module("hwboard").directive("wlButton",wlButton),wlButton.$inject=["$injector"],angular.module("hwboard").controller("ButtonController",ButtonController),ButtonController.$inject=["$scope","$injector","$log","$timeout"],angular.module("hwboard").directive("wlSwitch",wlSwitch),wlSwitch.$inject=["$injector"],angular.module("hwboard").controller("SwitchController",SwitchController),SwitchController.$inject=["$scope","$injector","$log","$timeout"],angular.module("hwboard").factory("statusUpdater",statusUpdater),statusUpdater.$inject=["$injector","$log","$timeout"],angular.module("hwboard").controller("TimerController",TimerController),TimerController.$inject=["$scope","$injector","$interval"],angular.module("hwboard").directive("wlTimer",wlTimer),angular.module("hwboard").filter("secondsToDateTime",[function(){return function(a){return new Date(1970,0,1).setSeconds(a)}}]);