"use strict";function MainController(a,b,c){function d(b){b!=a.status&&(a.status=b,a.apply())}function e(){statusUpdater.start()}function f(){statusUpdater.stop()}function g(a){c.debug("TIME IS: "+a)}statusUpdater=b.get("statusUpdater"),statusUpdater.setOnStatusUpdate(d),c.debug("HW board experiment main controller"),Weblab.setOnStartInteractionCallback(e),Weblab.setOnEndCallback(f),Weblab.setOnTimeCallback(g)}function WebcamController(a,b){function c(){f(function(){d()},100)}function d(){var b=URI(a.src);b.query({rnd:1e5*Math.random()}),a.src=b.toString()}var e=this,f=b.get("$timeout");e.programRefresh=c}function wlWebcam(){function a(a,b,c,d){function e(){d.programRefresh()}b.find("img").bind("load error",e)}return{restrict:"E",scope:{src:"@src"},templateUrl:"main/webcam/webcam.directive.html",controller:"WebcamController",controllerAs:"webcamController",link:a}}function StatusController(){}function wlStatus(){function a(){}return{restrict:"E",templateUrl:"main/status/status.directive.html",link:a,controller:"StatusController",controllerAs:"statusController",scope:{status:"=status",message:"=message"}}}function wlButton(){function a(){}return{restrict:"E",templateUrl:"main/button/button.directive.html",link:a,controller:"ButtonController",controllerAs:"buttonController",scope:{ident:"@ident",caption:"@caption",overlay:"@overlay",delay:"@delay"}}}function ButtonController(a,b,c,d){function e(){a.ongoingCommand||(a.ongoingCommand=!0,c.debug("Button "+a.ident+" pressed."),a.isPressed=!0,Weblab.dbgSetOfflineSendCommandResponse("ok"),Weblab.sendCommand("SetPulse on "+a.ident,f,g))}function f(){c.debug("[Button] SetPulse ON"),a.isOn=!0,a.isPressed=!1;var b=a.delay;void 0==b&&(c.error("[BUTTON]: Please define a button delay. Meanwhile setting it to 1000 ms"),b=1e3),d(function(){Weblab.sendCommand("SetPulse off "+a.ident,function(){c.debug("[Button] SetPulse OFF"),a.isOn=!1,a.isPressed=!1,a.ongoingCommand=!1,a.$apply()},function(b){c.error("SetPulse failed (while sending button pulse)"),c.error(b),a.ongoingCommand=!1,a.isPressed=!1,a.$apply()})},b),a.$apply()}function g(){c.error("SetPulse failed"),a.ongoingCommand=!1,a.isPressed=!1,a.$apply()}a.button={},a.isOn=!1,a.isPressed=!1,a.ongoingCommand=!1,a.press=e}function wlSwitch(){function a(){}return{restrict:"E",templateUrl:"main/switch/switch.directive.html",link:a,controller:"SwitchController",controllerAs:"switchController",scope:{ident:"@ident",caption:"@caption",overlay:"@overlay"}}}function SwitchController(a,b,c){function d(){if(!a.ongoingCommand){a.ongoingCommand=!0,c.debug("Switch "+a.ident+" pressed."),a.isPressed=!0,Weblab.dbgSetOfflineSendCommandResponse("ok");var b=a.isOn?"off":"on";Weblab.sendCommand("SetPulse "+b+" "+a.ident,e,f)}}function e(){c.debug("SetPulse succeeded"),a.isOn=!a.isOn,a.isPressed=!1,a.ongoingCommand=!1,a.$apply()}function f(){c.error("SetPulse failed"),a.ongoingCommand=!1,a.isPressed=!1,a.$apply()}a.button={},a.isOn=!1,a.isPressed=!1,a.ongoingCommand=!1,a.press=d}function statusUpdater(a){function b(){j=g(d,i)}function c(){g.cancel(j)}function d(){Weblab.dbgSetOfflineSendCommandResponse("programming"),Weblab.sendCommand("STATE",e,f)}function e(a){h.debug("SUCCESS: STATUS: "+a),j=g(d,i)}function f(a){h.error("ERROR: sendCommand (status)"),h.error(a),j=g(d,i)}var g=a.get("$timeout"),h=a.get("$log"),i=2e3,j=void 0;return{start:b,stop:c}}angular.module("hwboard",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"main/main.html",controller:"MainController"}).when("/about",{templateUrl:"main/about.html",controller:"AboutController"}).otherwise({redirectTo:"/"})}]),angular.module("hwboard").controller("MainController",MainController),MainController.$inject=["$scope","$injector","$log"],angular.module("hwboard").controller("AboutController",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("hwboard").controller("WebcamController",WebcamController),WebcamController.$inject=["$scope","$injector"],angular.module("hwboard").directive("wlWebcam",wlWebcam),angular.module("hwboard").controller("StatusController",StatusController),StatusController.$inject=["$scope","$injector"],angular.module("hwboard").directive("wlStatus",wlStatus),wlStatus.$inject=["$injector"],angular.module("hwboard").directive("wlButton",wlButton),wlButton.$inject=["$injector"],angular.module("hwboard").controller("ButtonController",ButtonController),ButtonController.$inject=["$scope","$injector","$log","$timeout"],angular.module("hwboard").directive("wlSwitch",wlSwitch),wlSwitch.$inject=["$injector"],angular.module("hwboard").controller("SwitchController",SwitchController),SwitchController.$inject=["$scope","$injector","$log","$timeout"],angular.module("hwboard").factory("statusUpdater",statusUpdater),statusUpdater.$inject=["$injector"];