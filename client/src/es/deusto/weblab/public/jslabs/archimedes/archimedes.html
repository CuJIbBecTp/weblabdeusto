<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Archimedes Experiment</title>

    <!-- Third-party libraries JS & CSS -->
    <link href="bootstrap3/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
    <link href="css/archimedes.css" rel="stylesheet" type="text/css"/>
    <link href="css/archimedes_design.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="//code.jquery.com/jquery-latest.min.js"></script>
    <script type="text/javascript" src="./bootstrap3/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mustache.js/0.7.2/mustache.min.js"></script>
    <script type="text/javascript" src="./libs/d3.v3.min.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/coffee-script/1.7.1/coffee-script.min.js"></script>
    <script type="text/javascript" src="./libs/jquery.i18n.min.js"></script>


    <!-- WebLab library -->
    <script type="text/javascript" src="../../jslib/weblabjs.js"></script>

    <!-- Archimedes-specific JS & CSS -->
    <link href="css/widgets.css" rel="stylesheet" type="text/css"/>
    <link href="css/timeweight_plot.css" rel="stylesheet" type="text/css"/>

    <script type="text/javascript" src="js/datatable.js"></script>
    <script type="text/coffeescript" src="js/retrievers.coffee"></script>
    <script type="text/javascript" src="js/imagezoom.js"></script>
    <script type="text/javascript" src="js/misc_ui.js"></script>
    <script type="text/javascript" src="js/archimedes_instance.js"></script>
    <script type="text/javascript" src="js/archimedes_experiment.js"></script>
    <script type="text/javascript" src="js/timeweight_plot.js"></script>
    <script type="text/javascript" src="js/widgets.js"></script>
    <script type="text/javascript" src="js/archimedes_design.js"></script>

</head>

<body>


<script type="text/javascript">

    var i18n = {
        "archimedes.experiment": "Archimedes Experiment",
        "time.remaining": "Time remaining",
        "ball.weight.liquid.level" : "Ball weight & Liquid level",
        "close": "Close",
        "hd.picture" : "HD Picture",

        "sensors": "Sensors",
        "liquid": "Liquid",
        "ball": "Ball",
        "liquid.level": "Liquid Level",
        "ball.weight": "Ball Weight",
        "volume": "Volume",
        "diameter": "Diameter",
        "internal.diameter": "Internal Diameter",
        "density": "Density",
        "mass": "Mass",
        "grams": "g",
        "cm": "cm",
        "kgm3": "kg/m³",
        "m3": "m³",
        "cm3": "cm³",


        // For the Weight/Time plot
        "plot.explanation": "Measures the perceived weight of the ball as reported by the sensor. The depicted timeframe is that of the last ball movement.",
        "time.weight.plot" : "Time / Weight Plot",
        "weight.g" : "Weight (g)",
        "seconds.s" : "Seconds (s)"
    };

    $.i18n.load(i18n);

    //! Gets the translation for an identifier.
    //!
    function getText(ident) {
        if(ident in i18n)
            return i18n[ident];
        else
            return "[" + ident + "]";
    }

    // TODO: Add some kind of resistence to individual failures of the instances.

    var Registry = {
        "default" : {
            "ball_mass": 31, // g
            "ball_diameter": 4, // cm
            "liquid_name": "water",
            "liquid_density": 1000, // 1000/m3
            "liquid_diameter": 6.5, // cm
            "webcam": "//www.weblab.deusto.es/webcam/proxied.py/splash1"
        },
//        "name1" : {
//            "ball_mass": 20,
//            "ball_density": 40,
//            "liquid_name": "water",
//            "liquid_density": 15,
//            "webcam": "http://whatever.com/name1.jpg"
//        },
//        "name2" : {
//            "ball_mass": 20,
//            "ball_density": 60,
//            "liquid_density": 1000, // 1000/m3
//            "liquid_diameter": 6.5, // cm
//            "liquid_name": "oil",
//            "webcam": "http://whatever.com/name2.jpg"
//        },
//        "name3" : {
//            "ball_mass": 20,
//            "ball_density": 60,
//            "liquid_density": 1000, // 1000/m3
//            "liquid_diameter": 6.5, // cm
//            "liquid_name": "oil",
//            "webcam": "http://whatever.com/name2.jpg"
//        }
    };

    // Possible values:
    // ["controls", "sensor_weight", "sensor_level", "webcam", "hdcam", "plot", "ball_mass", "ball_volume",
    // "ball_diameter", "ball_density", "liquid_density", "liquid_diameter", "liquid_volume"]
    var View = {
        "default" : ["controls", "sensor_weight", "sensor_level",  "webcam", "hdcam", "plot", "ball_mass",
        "ball_volume", "ball_diameter", "ball_density", "liquid_density", "liquid_diameter"]
    };
</script>

<script type="text/javascript">
    $(document).ready(function(){
        // global
        archimedesExperiment = new ArchimedesExperiment(Registry, View);

        // Carries out translations on the HTML, modifying the text
        // in those elements which are not dynamically created.
        translatePage();
    });


    function translatePage() {
        // Translate the strings in the experiment frame, etc.
        $(document).attr("title", $.i18n._("archimedes.experiment"));
        $("#hdModalLabelTitle").text($.i18n._("hd.picture"));
        $(".modal-footer > button").text($.i18n._("close"));
        $("#plotModalLabel").text($.i18n._("time.weight.plot"));

        // Translate the strings in the experiment instances.
    }


</script>


<!-- Large modal to show the HD picture -->
<!-- Modal -->
<div class="modal fade" id="photoModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="hdModalLabelTitle">HD picture</h4>
            </div>
            <div class="modal-body">
                <img id="hdpic" style="width: 100%; max-height: 600px; " src="">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Large modal to show the TIME/WEIGHT plot -->
<!-- Modal -->
<div class="modal fade" id="plotModal" tabindex="-1" role="dialog" aria-labelledby="plotModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="plotModalLabel">Time / Weight Plot</h4>
            </div>
            <div class="modal-body">
                <p id="plotexplanation"></p>

                <div id="plotModalBody">
                <!-- CONTENT WILL BE DYNAMICALLY APPENDED HERE -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>



<div class="container">

    <h2>
        <span class="timer" id="timer"></span>
    </h2>

    <div class="editmodeh hide" id="editmodeh">
        <h2>
            <span>
                DESIGN MODE
            </span>
        </h2>
        <p>
            Please, click on the elements you wish to hide.
        </p>
    </div>


    <div class="instances_row row clearfix">

        <!-- THE INSTANCE TEMPLATES WILL BE RENDERED HERE -->

    </div>

</div>


<script type="text/javascript">
//    setTimeout( function() {
//        ArchimedesDesign.enableDesignView();
//    }, 1500);
</script>


</body>
</html>
